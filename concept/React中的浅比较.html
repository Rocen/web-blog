<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web Blog</title>
    <meta name="description" content="Web Blog">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/web-blog/assets/style.CgBWWNxN.css" as="style">
    <link rel="preload stylesheet" href="/web-blog/vp-icons.css" as="style">
    
    <script type="module" src="/web-blog/assets/app.Dr5w_XLb.js"></script>
    <link rel="preload" href="/web-blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/web-blog/assets/chunks/theme.Gt9HHogB.js">
    <link rel="modulepreload" href="/web-blog/assets/chunks/framework.Bl5GZLa3.js">
    <link rel="modulepreload" href="/web-blog/assets/concept_React中的浅比较.md.GIwQzAEu.lean.js">
    <link rel="icon" href="/favicon.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a4cba12c><!--[--><!--]--><!--[--><span tabindex="-1" data-v-88a8cb41></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-88a8cb41>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a4cba12c data-v-aac6efe0><div class="VPNavBar" data-v-aac6efe0 data-v-3884d968><div class="wrapper" data-v-3884d968><div class="container" data-v-3884d968><div class="title" data-v-3884d968><div class="VPNavBarTitle has-sidebar" data-v-3884d968 data-v-58eee3d4><a class="title" href="/web-blog/" data-v-58eee3d4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/web-blog/javascript.png" alt data-v-7018b892><!--]--><span data-v-58eee3d4>Web Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-3884d968><div class="content-body" data-v-3884d968><!--[--><!--]--><div class="VPNavBarSearch search" data-v-3884d968><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-3884d968 data-v-9d15defd><span id="main-nav-aria-label" class="visually-hidden" data-v-9d15defd> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/web-blog/" tabindex="0" data-v-9d15defd data-v-79e74c62><!--[--><span data-v-79e74c62>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/web-blog/guide/" tabindex="0" data-v-9d15defd data-v-79e74c62><!--[--><span data-v-79e74c62>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/web-blog/guide/test.html" tabindex="0" data-v-9d15defd data-v-79e74c62><!--[--><span data-v-79e74c62>GuideTest</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-3884d968 data-v-25bc2676><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-25bc2676 data-v-ede464e2 data-v-019d2d21><span class="check" data-v-019d2d21><span class="icon" data-v-019d2d21><!--[--><span class="vpi-sun sun" data-v-ede464e2></span><span class="vpi-moon moon" data-v-ede464e2></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-3884d968 data-v-e7a2a48b data-v-5a009cac><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-5a009cac data-v-99001c8a><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-3884d968 data-v-607ef21f data-v-1cd8686e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-1cd8686e><span class="vpi-more-horizontal icon" data-v-1cd8686e></span></button><div class="menu" data-v-1cd8686e><div class="VPMenu" data-v-1cd8686e data-v-615fc6ac><!----><!--[--><!--[--><!----><div class="group" data-v-607ef21f><div class="item appearance" data-v-607ef21f><p class="label" data-v-607ef21f>Appearance</p><div class="appearance-action" data-v-607ef21f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-607ef21f data-v-ede464e2 data-v-019d2d21><span class="check" data-v-019d2d21><span class="icon" data-v-019d2d21><!--[--><span class="vpi-sun sun" data-v-ede464e2></span><span class="vpi-moon moon" data-v-ede464e2></span><!--]--></span></span></button></div></div></div><div class="group" data-v-607ef21f><div class="item social-links" data-v-607ef21f><div class="VPSocialLinks social-links-list" data-v-607ef21f data-v-5a009cac><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-5a009cac data-v-99001c8a><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-3884d968 data-v-215e07c1><span class="container" data-v-215e07c1><span class="top" data-v-215e07c1></span><span class="middle" data-v-215e07c1></span><span class="bottom" data-v-215e07c1></span></span></button></div></div></div></div><div class="divider" data-v-3884d968><div class="divider-line" data-v-3884d968></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a4cba12c data-v-e7a8c418><div class="container" data-v-e7a8c418><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e7a8c418><span class="vpi-align-left menu-icon" data-v-e7a8c418></span><span class="menu-text" data-v-e7a8c418>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e7a8c418 data-v-8fa4cf31><button data-v-8fa4cf31>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a4cba12c data-v-c6614c00><div class="curtain" data-v-c6614c00></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c6614c00><span class="visually-hidden" id="sidebar-aria-label" data-v-c6614c00> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-b0829ed6><section class="VPSidebarItem level-0" data-v-b0829ed6 data-v-dafd2763><!----><div class="items" data-v-dafd2763><!--[--><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>Home</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b0829ed6><section class="VPSidebarItem level-0" data-v-b0829ed6 data-v-dafd2763><div class="item" role="button" tabindex="0" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><h2 class="text" data-v-dafd2763>Javascript</h2><!----></div><div class="items" data-v-dafd2763><!--[--><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/javascript/Object.defineProperty%E5%92%8CProxy.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>Object.defineProperty和Proxy</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b0829ed6><section class="VPSidebarItem level-0" data-v-b0829ed6 data-v-dafd2763><div class="item" role="button" tabindex="0" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><h2 class="text" data-v-dafd2763>CSS</h2><!----></div><div class="items" data-v-dafd2763><!--[--><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/css/BFC.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>BFC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/css/%E5%8C%BA%E5%9D%97%E7%9B%92%E5%AD%90%E5%92%8C%E8%A1%8C%E5%86%85%E7%9B%92%E5%AD%90.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>区块盒子和行内盒子</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/css/TailwindCSS%E5%8E%9F%E7%90%86.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>TailwindCSS原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/css/Grid.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>Grid</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/css/Flex.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>Flex</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b0829ed6><section class="VPSidebarItem level-0" data-v-b0829ed6 data-v-dafd2763><div class="item" role="button" tabindex="0" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><h2 class="text" data-v-dafd2763>工程化</h2><!----></div><div class="items" data-v-dafd2763><!--[--><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/Compiler%E5%92%8CCompilation.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>Compiler和Compilation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/webpack%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>webpack工作流程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/webpack%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>webpack性能优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/webpack%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%88%E4%B8%BE%E4%BE%8B%EF%BC%89.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>webpack性能优化（举例）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/webpack%20splitChunks%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>webpack splitChunks最佳实践</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/engineering/webpack%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>webpack热更新原理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-b0829ed6><section class="VPSidebarItem level-0 has-active" data-v-b0829ed6 data-v-dafd2763><div class="item" role="button" tabindex="0" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><h2 class="text" data-v-dafd2763>概念</h2><!----></div><div class="items" data-v-dafd2763><!--[--><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/concept/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>深拷贝和浅拷贝</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/concept/%E6%B7%B1%E6%AF%94%E8%BE%83%E5%92%8C%E6%B5%85%E6%AF%94%E8%BE%83.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>深比较和浅比较</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-dafd2763 data-v-dafd2763><div class="item" data-v-dafd2763><div class="indicator" data-v-dafd2763></div><a class="VPLink link link" href="/web-blog/concept/React%E4%B8%AD%E7%9A%84%E6%B5%85%E6%AF%94%E8%BE%83.html" data-v-dafd2763><!--[--><p class="text" data-v-dafd2763>React中的浅比较</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a4cba12c data-v-de90f256><div class="VPDoc has-sidebar has-aside" data-v-de90f256 data-v-fe0b286c><!--[--><!--]--><div class="container" data-v-fe0b286c><div class="aside" data-v-fe0b286c><div class="aside-curtain" data-v-fe0b286c></div><div class="aside-container" data-v-fe0b286c><div class="aside-content" data-v-fe0b286c><div class="VPDocAside" data-v-fe0b286c data-v-8d42c92f><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-8d42c92f data-v-ad9d4535><div class="content" data-v-ad9d4535><div class="outline-marker" data-v-ad9d4535></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-ad9d4535>On this page</div><ul class="VPDocOutlineItem root" data-v-ad9d4535 data-v-c561ae38><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-8d42c92f></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-fe0b286c><div class="content-container" data-v-fe0b286c><!--[--><!--]--><main class="main" data-v-fe0b286c><div style="position:relative;" class="vp-doc _web-blog_concept_React%E4%B8%AD%E7%9A%84%E6%B5%85%E6%AF%94%E8%BE%83" data-v-fe0b286c><div><p>在 React 中，<strong><code>useEffect</code>、<code>useMemo</code>、<code>useCallback</code> 等 Hook 的依赖项数组（第二个参数）的比较方式确实是浅比较</strong>，但具体实现是基于 <code>Object.is</code> 算法，而不是简单的 <code>===</code> 运算符。以下是详细说明和注意事项：</p><hr><h3 id="_1-依赖项的比较方式" tabindex="-1"><strong>1. 依赖项的比较方式</strong> <a class="header-anchor" href="#_1-依赖项的比较方式" aria-label="Permalink to &quot;**1. 依赖项的比较方式**&quot;">​</a></h3><p>React 对依赖项数组中的每一项进行<strong>浅比较</strong>，具体规则如下：</p><ul><li><strong>基本类型</strong>（如 <code>number</code>、<code>string</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>、<code>Symbol</code>）：<br> 直接比较值是否相同（<code>Object.is(value1, value2)</code>）。</li><li><strong>引用类型</strong>（如对象、数组、函数）：<br> 比较的是它们的<strong>内存引用</strong>是否一致（即是否是同一个对象或函数实例），<strong>不会递归检查内部属性是否变化</strong>。</li></ul><h4 id="示例" tabindex="-1">示例： <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例：&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 即使内容相同，引用不同，浅比较认为不相等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj1, obj2); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span></code></pre></div><hr><h3 id="_2-为什么-react-使用浅比较" tabindex="-1"><strong>2. 为什么 React 使用浅比较？</strong> <a class="header-anchor" href="#_2-为什么-react-使用浅比较" aria-label="Permalink to &quot;**2. 为什么 React 使用浅比较？**&quot;">​</a></h3><ul><li><strong>性能优化</strong>：<br> 深比较需要递归遍历所有属性，对复杂对象可能导致性能问题。浅比较的时间复杂度为 O(1)（基本类型）或 O(n)（依赖项数组长度），效率更高。</li><li><strong>不可变数据模式</strong>：<br> React 鼓励使用不可变数据（如通过 <code>setState</code> 返回新对象），依赖项引用变化即代表数据已更新，浅比较可以快速检测到变化。</li><li><strong>避免意外行为</strong>：<br> 如果依赖项是动态生成的对象或函数（如 <code>() =&gt; {}</code> 或 <code>{ key: value }</code>），每次渲染都会生成新的引用，深比较会导致依赖项永远“不相等”，反而触发无限更新。</li></ul><hr><h3 id="_3-依赖项是引用类型的陷阱" tabindex="-1"><strong>3. 依赖项是引用类型的陷阱</strong> <a class="header-anchor" href="#_3-依赖项是引用类型的陷阱" aria-label="Permalink to &quot;**3. 依赖项是引用类型的陷阱**&quot;">​</a></h3><p>如果依赖项是对象、数组或函数，且未保持引用稳定，可能导致 Hook 频繁触发：</p><h4 id="错误示例" tabindex="-1">错误示例： <a class="header-anchor" href="#错误示例" aria-label="Permalink to &quot;错误示例：&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ❌ 每次渲染时，dataFiltered 都是新对象，导致 useEffect 重复执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataFiltered</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.isActive);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 副作用逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [dataFiltered]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 依赖项引用每次变化，触发 effect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="正确修复方法" tabindex="-1">正确修复方法： <a class="header-anchor" href="#正确修复方法" aria-label="Permalink to &quot;正确修复方法：&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ✅ 使用 useMemo 保持引用稳定（当 data 和过滤条件未变时，返回缓存值）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataFiltered</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.isActive),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [data] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 仅当 data 变化时重新计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 副作用逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, [dataFiltered]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 依赖项引用稳定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h3 id="_4-如何实现深比较依赖项" tabindex="-1"><strong>4. 如何实现深比较依赖项？</strong> <a class="header-anchor" href="#_4-如何实现深比较依赖项" aria-label="Permalink to &quot;**4. 如何实现深比较依赖项？**&quot;">​</a></h3><p>React 不原生支持深比较依赖项，但可通过以下方式手动处理：</p><h4 id="方法-1-自定义-hook-结合-useref-和深比较库" tabindex="-1">方法 1：自定义 Hook（结合 <code>useRef</code> 和深比较库） <a class="header-anchor" href="#方法-1-自定义-hook-结合-useref-和深比较库" aria-label="Permalink to &quot;方法 1：自定义 Hook（结合 `useRef` 和深比较库）&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { isEqual } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;lodash&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useDeepCompareEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prevDeps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dependencies);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 手动深比较依赖项</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prevDeps.current, dependencies)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prevDeps.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dependencies;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(effect, [prevDeps.current]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useDeepCompareEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 副作用逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [obj]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 依赖项 obj 的内容变化时触发</span></span></code></pre></div><h4 id="方法-2-序列化依赖项-仅适用于可序列化数据" tabindex="-1">方法 2：序列化依赖项（仅适用于可序列化数据） <a class="header-anchor" href="#方法-2-序列化依赖项-仅适用于可序列化数据" aria-label="Permalink to &quot;方法 2：序列化依赖项（仅适用于可序列化数据）&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 副作用逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj)]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当 obj 的 JSON 字符串变化时触发</span></span></code></pre></div><h4 id="注意事项" tabindex="-1">注意事项： <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项：&quot;">​</a></h4><ul><li><strong>性能风险</strong>：深比较或序列化可能对大型对象造成性能问题。</li><li><strong>特殊类型限制</strong>：<code>JSON.stringify</code> 无法处理 <code>Date</code>、<code>Set</code>、循环引用等。</li><li><strong>推荐场景</strong>：仅在依赖项变化频率低且数据结构简单时使用。</li></ul><hr><h3 id="_5-总结" tabindex="-1"><strong>5. 总结</strong> <a class="header-anchor" href="#_5-总结" aria-label="Permalink to &quot;**5. 总结**&quot;">​</a></h3><table tabindex="0"><thead><tr><th><strong>场景</strong></th><th><strong>解决方案</strong></th></tr></thead><tbody><tr><td>依赖项是基本类型</td><td>直接使用浅比较，无需额外处理。</td></tr><tr><td>依赖项是对象/数组/函数</td><td>使用 <code>useMemo</code>、<code>useCallback</code> 或 <code>useState</code> 保持引用稳定。</td></tr><tr><td>必须依赖嵌套对象的变化</td><td>手动提取关键字段作为依赖项（如 <code>[obj.id, obj.value]</code>）。</td></tr><tr><td>需要深度比较</td><td>自定义 Hook 结合深比较库（如 Lodash 的 <code>_.isEqual</code>），但需谨慎评估性能。</td></tr></tbody></table><hr><h3 id="_6-官方推荐实践" tabindex="-1"><strong>6. 官方推荐实践</strong> <a class="header-anchor" href="#_6-官方推荐实践" aria-label="Permalink to &quot;**6. 官方推荐实践**&quot;">​</a></h3><ol><li><strong>最小化依赖项</strong>：<br> 仅将真正影响副作用的变量放入依赖项数组。</li><li><strong>保持引用稳定</strong>：<br> 对对象、数组使用 <code>useMemo</code>，对函数使用 <code>useCallback</code>。</li><li><strong>避免动态生成依赖项</strong>：<br> 不要在 Hook 内部直接创建对象或函数作为依赖项。</li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确示例：保持依赖项引用稳定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 请求逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [apiUrl, params]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> processedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useMemo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(transform);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [data]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, [fetchData]);</span></span></code></pre></div><hr><p>通过合理使用浅比较和引用稳定化技术，可以确保 React Hook 的行为符合预期，同时避免性能问题。</p></div></div></main><footer class="VPDocFooter" data-v-fe0b286c data-v-9be8bc63><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-9be8bc63><span class="visually-hidden" id="doc-footer-aria-label" data-v-9be8bc63>Pager</span><div class="pager" data-v-9be8bc63><a class="VPLink link pager-link prev" href="/web-blog/concept/%E6%B7%B1%E6%AF%94%E8%BE%83%E5%92%8C%E6%B5%85%E6%AF%94%E8%BE%83.html" data-v-9be8bc63><!--[--><span class="desc" data-v-9be8bc63>Previous page</span><span class="title" data-v-9be8bc63>深比较和浅比较</span><!--]--></a></div><div class="pager" data-v-9be8bc63><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"concept_react中的浅比较.md\":\"GIwQzAEu\",\"concept_深拷贝和浅拷贝.md\":\"BFxXO1Tp\",\"concept_深比较和浅比较.md\":\"SvushT9e\",\"css_bfc.md\":\"D1ibRZXB\",\"css_flex.md\":\"ByNvVzLl\",\"css_grid.md\":\"BejLy0Sn\",\"css_tailwindcss原理.md\":\"QxvKUvJ7\",\"css_区块盒子和行内盒子.md\":\"CeSzhBHC\",\"engineering_compiler和compilation.md\":\"CnnTo0A4\",\"engineering_webpack splitchunks最佳实践.md\":\"8i-0t7hY\",\"engineering_webpack工作流程.md\":\"DggiUi1O\",\"engineering_webpack性能优化.md\":\"RtdIFEtj\",\"engineering_webpack性能优化（举例）.md\":\"B-unPHv_\",\"engineering_webpack热更新原理.md\":\"ChwmTWmZ\",\"index.md\":\"BObrD3OP\",\"javascript_object.defineproperty和proxy.md\":\"-EfAs6s7\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Web Blog\",\"description\":\"Web Blog\",\"base\":\"/web-blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Guide\",\"link\":\"/guide/\"},{\"text\":\"GuideTest\",\"link\":\"/guide/test\"}],\"logo\":\"/javascript.png\",\"sidebar\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Javascript\",\"items\":[{\"text\":\"Object.defineProperty和Proxy\",\"link\":\"/javascript/Object.defineProperty和Proxy\"}]},{\"text\":\"CSS\",\"items\":[{\"text\":\"BFC\",\"link\":\"/css/BFC\"},{\"text\":\"区块盒子和行内盒子\",\"link\":\"/css/区块盒子和行内盒子\"},{\"text\":\"TailwindCSS原理\",\"link\":\"/css/TailwindCSS原理\"},{\"text\":\"Grid\",\"link\":\"/css/Grid\"},{\"text\":\"Flex\",\"link\":\"/css/Flex\"}]},{\"text\":\"工程化\",\"items\":[{\"text\":\"Compiler和Compilation\",\"link\":\"/engineering/Compiler和Compilation\"},{\"text\":\"webpack工作流程\",\"link\":\"/engineering/webpack工作流程\"},{\"text\":\"webpack性能优化\",\"link\":\"/engineering/webpack性能优化\"},{\"text\":\"webpack性能优化（举例）\",\"link\":\"/engineering/webpack性能优化（举例）\"},{\"text\":\"webpack splitChunks最佳实践\",\"link\":\"/engineering/webpack splitChunks最佳实践\"},{\"text\":\"webpack热更新原理\",\"link\":\"/engineering/webpack热更新原理\"}]},{\"text\":\"概念\",\"items\":[{\"text\":\"深拷贝和浅拷贝\",\"link\":\"/concept/深拷贝和浅拷贝\"},{\"text\":\"深比较和浅比较\",\"link\":\"/concept/深比较和浅比较\"},{\"text\":\"React中的浅比较\",\"link\":\"/concept/React中的浅比较\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>